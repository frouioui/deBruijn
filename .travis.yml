language: haskell

ghc:
  - "7.8"

sudo: true

service:
  - docker

git:
  depth: false
  quiet: true

cache:
  directories:
    - $HOME/.stack

notifications:
  email:
    recipients:
    - florent.poinsard@epitech.eu
    on_success: never
    on_failure: always
  slack: epitech-tls-22:OsWtUSdnX45sPtL2EbBPO8aA

before_install:
  - mkdir -p ~/.local/bin
  - export PATH=$HOME/.local/bin:$PATH
  - travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'

jobs:
    include :
        - stage: build
          name: "Build"
          script:
            - make

        - stage: tests
          name: "Unit Tests"
          script:
            - stack --no-terminal --skip-ghc-check test

        - stage: deploy
          name: "Deployement"
          if: branch IN (master, travis) AND type != cron AND type != pull_request
          before_script:
            - ssh-keyscan git.epitech.eu >> ~/.ssh/known_hosts
            - git checkout $TRAVIS_BRANCH
          script:
            - git push --repo=git@git.epitech.eu:/florent.poinsard@epitech.eu/FUN_deBruijn_2018 --force